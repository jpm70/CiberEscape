<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Escape Room: Centro de Comando (Desaf√≠o CTF)</title>
    <!-- Carga de Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Roboto+Mono:wght@400;700&display=swap" rel="stylesheet">
    <style>
        /* Estilos de Terminal Consistentes */
        body {
            font-family: 'Roboto Mono', monospace;
            background-color: #0d1117; 
            color: #00ff00; 
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .container {
            border: 1px solid #00ff0033; 
            box-shadow: 0 0 20px #00ff0044; 
        }
        .terminal-header {
            background-color: #161b22;
            color: #ffffff;
            font-weight: bold;
            border-bottom: 1px solid #00ff0033;
        }
        .message-box {
            min-height: 4rem; 
        }
    </style>
</head>
<body class="p-4" onload="updateChallengeUI()">
    <div class="container w-full max-w-lg p-6 md:p-8 rounded-lg">
        <div class="terminal-header p-2 rounded-t-lg flex justify-between items-center">
            <span>Escapar.exe - M√≥dulo de Validaci√≥n</span>
            <div class="space-x-1">
                <span class="inline-block w-3 h-3 bg-red-500 rounded-full"></span>
                <span class="inline-block w-3 h-3 bg-yellow-500 rounded-full"></span>
                <span class="inline-block w-3 h-3 bg-green-500 rounded-full"></span>
            </div>
        </div>

        <div class="p-6">
            <h1 class="text-3xl font-bold mb-4 text-white">Prueba del Analista</h1>
            <div class="mb-6">
                <a href="hash_cracker.html" class="inline-block bg-blue-600 hover:bg-blue-700 text-white text-xs font-bold py-2 px-4 rounded transition-colors border border-blue-400">
                    üõ†Ô∏è Abrir Herramienta de Cracking
                </a>
            </div>
            <div class="p-3 rounded bg-gray-800 border border-gray-700 mb-6">
                <p class="text-sm text-white">
                    Desaf√≠o Actual: 
                    <span id="challengeTitle" class="font-bold text-yellow-400"></span>
                </p>
                <p class="text-xs text-gray-400 mt-1">
                    Progreso: <span id="challengeProgress">1 de 5</span>
                </p>
            </div>

            <p id="currentHint" class="mb-6 text-cyan-300">
                <!-- El texto de la Pista 1 debe ser impreso f√≠sicamente seg√∫n el plan -->
                ¬°Busca la Pista 1 impresa en tu mesa para comenzar la investigaci√≥n!
            </p>
            
            <!-- Entrada para introducir los c√≥digos -->
            <div class="mt-6">
                <label for="codeInput" class="block text-sm font-medium mb-2 text-cyan-300">Introduce el C√≥digo de Validaci√≥n:</label>
                <input type="text" id="codeInput" placeholder="C√ìDIGO_A_VALIDAR" 
                       class="w-full p-3 rounded bg-gray-800 text-yellow-300 border border-gray-700 focus:ring-green-500 focus:border-green-500 uppercase" 
                       autocomplete="off">
            </div>

            <button onclick="validateCode()" 
                    class="mt-4 w-full bg-green-700 hover:bg-green-600 text-white font-bold py-3 px-4 rounded transition-colors duration-200">
                Validar C√≥digo
            </button>

            <div id="message" class="message-box mt-4 p-3 rounded text-center text-sm font-semibold transition-all">
                &nbsp;
            </div>

            <div class="mt-6 text-center">
                <p class="text-sm text-gray-500">CTF Security Challenge 2025</p>
            </div>
        </div>
    </div>

    <script>
        // --- 1. CONFIGURACI√ìN DEL JUEGO (Basado en el plan) ---
        const FINAL_FLAG = "FINAL_FLAG{INV3ST1GAC1ON_Y_CR4CK1NG_L0GRAD0}";
        
        const CHALLENGES = [
            // DESAF√çO 1: Hash MD5 de 'S3CURITY10' se encuentra en el c√≥digo fuente.
            { id: 1, theme: "Criptograf√≠a / Hashes", expected: "S3CURITY10", nextHint: "¬°Hash descifrado! Busca un fallo en el software de correo 'MailServer v5.0.1'. Necesitas el c√≥digo CVE." },
            // DESAF√çO 2: B√∫squeda del CVE por nombre de software.
            { id: 2, theme: "B√∫squeda de Vulnerabilidades (CVE)", expected: "CVE-2024-1234", nextHint: "¬°CVE encontrado! La siguiente clave est√° codificada en Base64 en un archivo JS externo (external.js). Decodif√≠cala para obtener la API Key." },
            // DESAF√çO 3: Decodificaci√≥n Base64 de la API Key.
            { id: 3, theme: "Codificaci√≥n / API Key (Base64)", expected: "APIKEY_DECODE", nextHint: "¬°API Key decodificada! Ahora, identifica el c√≥digo CWE que corresponde a una 'Inyecci√≥n XSS Reflejada'." },
            // DESAF√çO 4: B√∫squeda del c√≥digo CWE para XSS Reflejada.
            { id: 4, theme: "Debilidades Comunes (CWE)", expected: "CWE-79", nextHint: "¬°CWE identificado! El √∫ltimo c√≥digo est√° en un archivo de configuraci√≥n olvidado y sin protecci√≥n: 'config.txt'. B√∫scalo en la ra√≠z del servidor." },
            // DESAF√çO 5: Simulaci√≥n de fallo de configuraci√≥n (acceso a config.txt).
            { id: 5, theme: "Fallo de Configuraci√≥n", expected: "CONFIG_FAIL", nextHint: FINAL_FLAG }
        ];

        // --- 2. ESTADO DEL JUEGO ---
        // Usamos localStorage para simular el progreso entre recargas
        let currentChallengeId = parseInt(localStorage.getItem('currentChallengeId')) || 1;
        let currentChallenge = CHALLENGES.find(c => c.id === currentChallengeId) || CHALLENGES[0];

        // --- 3. ELEMENTOS DEL DOM ---
        const MESSAGE_BOX = document.getElementById('message');
        const CODE_INPUT = document.getElementById('codeInput');
        const CHALLENGE_TITLE = document.getElementById('challengeTitle');
        const CHALLENGE_PROGRESS = document.getElementById('challengeProgress');
        const CURRENT_HINT = document.getElementById('currentHint');

        /**
         * Inicializa o actualiza la interfaz de usuario con el estado del desaf√≠o actual.
         */
        function updateChallengeUI() {
            if (currentChallengeId > 5) {
                CHALLENGE_TITLE.textContent = "COMPLETADO";
                CHALLENGE_PROGRESS.textContent = "5 de 5";
                CURRENT_HINT.innerHTML = `<span class="text-lg font-bold text-green-400">¬°ESCAPASTE! La Bandera Maestra es: ${FINAL_FLAG}</span>`;
                CODE_INPUT.disabled = true;
            } else {
                currentChallenge = CHALLENGES.find(c => c.id === currentChallengeId);
                CHALLENGE_TITLE.textContent = currentChallenge.theme;
                CHALLENGE_PROGRESS.textContent = `${currentChallengeId} de 5`;
                if (currentChallengeId > 1) {
                    // Muestra la pista del desaf√≠o anterior para guiar al siguiente.
                    CURRENT_HINT.textContent = currentChallenge.nextHint;
                }
            }
        }

        /**
         * Valida el c√≥digo introducido por el usuario.
         */
        async function validateCode() {
            const input = CODE_INPUT.value.trim().toUpperCase();
            
            MESSAGE_BOX.textContent = "Verificando...";
            MESSAGE_BOX.className = 'message-box mt-4 p-3 rounded text-center text-sm font-semibold bg-gray-700 text-white transition-all';
            
            await new Promise(resolve => setTimeout(resolve, 500)); 

            if (currentChallengeId > 5) {
                MESSAGE_BOX.textContent = "Juego ya completado. ¬°Has ganado!";
                MESSAGE_BOX.className = 'message-box mt-4 p-3 rounded text-center text-sm font-semibold bg-green-900 text-green-300';
                return;
            }

            if (input === currentChallenge.expected) {
                // √âxito: Avanzar al siguiente desaf√≠o
                MESSAGE_BOX.textContent = `¬°C√≥digo ${currentChallengeId} validado! Avanzando al siguiente desaf√≠o.`;
                MESSAGE_BOX.className = 'message-box mt-4 p-3 rounded text-center text-sm font-semibold bg-green-900 text-green-300 shadow-lg shadow-green-900/50';

                currentChallengeId++;
                localStorage.setItem('currentChallengeId', currentChallengeId);
                CODE_INPUT.value = '';
                
                // Actualizar UI con el nuevo estado y la nueva pista
                setTimeout(updateChallengeUI, 1000);

            } else {
                // Fallo
                 MESSAGE_BOX.textContent = "C√≥digo Incorrecto. ¬°Sigue investigando!";
                 MESSAGE_BOX.className = 'message-box mt-4 p-3 rounded text-center text-sm font-semibold bg-red-900 text-red-300 shadow-lg shadow-red-900/50';
            }
        }
    </script>
</body>
<!-- *************************************************************** -->
<!-- CLAVE DE ACCESO DEL DESAF√çO 1 (HASH MD5 para 'S3CURITY10'): -->
<!-- 0702F2358826D9C6E3B5641753177759 -->
<!-- *************************************************************** -->
</html>